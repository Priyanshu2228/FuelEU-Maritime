import { expect, describe, it } from 'vitest';
import computeCB from '../../application/usecases/ComputeCB';

describe('ComputeCB', () => {
  it('should correctly calculate compliance balance', () => {
    const result = computeCB({
      ghgIntensity: 91.0,
      fuelConsumptionTons: 5000
    });

    // Energy in scope = fuelConsumption × 41000 MJ/t
    // Target = 89.3368 gCO2e/MJ
    // CB = (Target - Actual) × Energy in scope
    expect(result.cb_gCO2e).toBeLessThan(0); // Should be negative as actual > target
  });

  it('should return positive CB when below target', () => {
    const result = computeCB({
      ghgIntensity: 88.0,
      fuelConsumptionTons: 4800
    });

    expect(result.cb_gCO2e).toBeGreaterThan(0);
  });

  it('should handle zero fuel consumption', () => {
    const result = computeCB({
      ghgIntensity: 91.0,
      fuelConsumptionTons: 0
    });

    expect(result.cb_gCO2e).toBe(0);
  });

  it('should calculate exact target scenario', () => {
    const result = computeCB({
      ghgIntensity: 89.3368,
      fuelConsumptionTons: 5000
    });

    expect(result.cb_gCO2e).toBeCloseTo(0, 2);
  });
});
